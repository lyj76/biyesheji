# Volterra 非线性均衡器 (VNLE) 原理详解

本文档旨在用最直观的**矩阵/向量视角**，揭示 Volterra 非线性均衡器（VNLE）的数学本质。

如果你已经理解了线性 FFE 的“正规方程”和“投影”概念，那么 VNLE 对你来说其实**没有任何新东西**——它只是把原来的向量变得**更长、更胖**了而已。

---

## 1. 核心痛点：为什么线性 FFE 不够用？

线性 FFE 的假设是：
$$ y(n) = h_1 x(n) + h_2 x(n-1) + ... $$
这是一个**线性组合**。它假设系统是线性的。

**但在真实世界（特别是光通信）里，器件是不老实的：**
*   **光电二极管 (PD)**: 是个平方律器件（光功率 -> 电流， $I ope |E|^2$）。
*   **光纤非线性**: 光太强时，折射率会变（克尔效应），产生 $x^3$ 项。
*   **电放大器**: 饱和时会产生削波。

如果你只用线性 FFE，就像试图用一把直尺去量一个圆的周长——无论你怎么摆，永远都有误差。

---

## 2. 破局之道：升维打击 (Kernel Trick)

### 2.1 即使是弯曲的，在高维看也是直的
既然输入 $x$ 和输出 $y$ 的关系不是线性的，那我们能不能**造**出一些新特征，让关系变回线性？

假设真实关系是抛物线：$y = 3x^2 + 2x + 1$。
这是一个非线性方程。

**但如果我们定义一个新向量：**
$$ \mathbf{X}_{new} = [1, x, x^2] $$
$$ \mathbf{H}_{new} = [1, 2, 3]^T $$
那么：
$$ y = \mathbf{H}_{new}^T \cdot \mathbf{X}_{new} $$
**看！它变回了完美的线性向量乘法！** $\mathbf{h}^T \mathbf{x}$ 的形式完全没变！

这就是 Volterra 级数的本质：**通过穷举所有可能的非线性项（$x^2, x^3, x_1 x_2...$），把非线性问题转化为高维线性问题。**

---

## 3. 数学定义：从一阶到高阶

### 3.1 线性项 (一阶核)
这是我们熟悉的 FFE：
$$ y_1(n) = \sum h_1(k) \cdot x(n-k) $$

### 3.2 二阶项 (Volterra 核心)
这是 VNLE 新增加的部分——**两两相乘**：
$$ y_2(n) = \sum \sum h_2(j, k) \cdot x(n-j) \cdot x(n-k) $$

这包含了：
1.  **自平方项**: $x(n)^2, x(n-1)^2$ (能量项)
2.  **交叉项**: $x(n)x(n-1)$ (记忆非线性，即前一个符号太强，会扭曲当前符号的形状)

### 3.3 矩阵形式 (你的最爱)

假设 memory length $N=2$。
时刻 $n$ 的输入窗是 $[x_1, x_2]$。

**线性 FFE 的向量：**
$$ \mathbf{x}_{Lin} = [x_1, x_2]^T $$
系数 $\mathbf{h}$ 有 2 个。

**VNLE 的向量（我们手动把它变长）：**
$$ \mathbf{x}_{Volterra} = [\underbrace{x_1, x_2}_{\text{原始项}}, \underbrace{x_1^2, x_1 x_2, x_2^2}_{\text{扩充项}}]^T $$
系数 $\mathbf{h}$ 现在的长度变成了 $2 + 3 = 5$ 个。

**运算公式依然是：**
$$ y = \mathbf{h}_{big}^T \cdot \mathbf{x}_{big} $$

**RLS 依然是：**
$$ \mathbf{h}_{new} = \mathbf{h}_{old} + \mathbf{k} \cdot e $$

**结论：**
**所有的数学推导（正规方程、RLS、最小二乘）完全不用改！**
仅仅是在喂给算法之前，先把数据 $\mathbf{x}$ 做一次“**非线性展开/预处理**”而已。

---

## 4. 代码中的具体实现 (WL 参数)

代码中的 `WL` (Window Length for Nonlinearity) 参数控制了我们要考虑“多远的过去”产生的非线性影响。

如果 `WL=3`，意味着我们要计算：
1.  $x(n)$ 与 $x(n), x(n-1), x(n-2)$ 的乘积
2.  $x(n-1)$ 与 ... 的乘积

这将产生大量的组合项。
代码里的双重循环就是用来生成这些 $x(i) ope x(j)$ 项的。

```matlab
% 代码逻辑重构
x1 = [线性项];
x2 = [];
for m = 1:WL
    % 生成交叉项 x(k) * x(k-m)
    x2 = [x2; 移位向量A .* 移位向量B];
end
x_Final = [x1; x2]; % 拼接
```

---

## 5. 复杂度警告

虽然数学上很简单（只是向量变长），但在工程上代价巨大。
如果线性长度是 $N=100$。
*   线性 FFE 需要算 100 次乘法。
*   全二阶 Volterra 需要算 $100 \times 100 / 2 \approx 5000$ 次乘法！

这也是为什么代码里会有 `N2` (非线性项的长度) 这个参数——通常我们要比线性长度 `N1` 小得多，只处理最近的几个非线性干扰。

```

